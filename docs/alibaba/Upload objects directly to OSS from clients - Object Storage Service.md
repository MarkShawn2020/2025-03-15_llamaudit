---
title: Upload objects directly to OSS from clients - Object Storage Service
source: https://www.alibabacloud.com/help/en/oss/use-cases/uploading-objects-to-oss-directly-from-clients/
---

Unlock the Power of AI

1 million free tokens

88% Price Reduction

Activate Now
English
  Cart
Console
Log In
Home Page
Object Storage Service
Use Cases
Direct client uploads
Search for Help Content
Upload objects directly to OSS from clients
Updated at: 2024-11-15 06:15
Product
Community

A direct client upload allows you to upload data directly to Object Storage Service (OSS) from clients. The direct client upload solution accelerates uploads and reduces the resource usage of the application server by eliminating the need to transfer objects to and from the application server. This topic describes the benefits, implementation methods, and best practices of this solution.

Benefits

In the traditional server and client architecture, uploading data to OSS from the application server is the common upload method. The client uploads objects to the application server, and then the application server uploads the objects to OSS. During the upload process, data must be transferred twice over the network. This results in a waste of network resources and an increase in the resource usage of the application server. To resolve this issue, you can upload objects directly to OSS without the need to upload the objects to the application server.

Implementation methods

To upload data directly to OSS from clients, you must resolve the following issues:

CORS

If your client is a web client or mini program, you must allow cross-origin resource sharing (CORS). In most cases, browsers and mini programs prohibit CORS to ensure data security. This prevents your client code from being used to connect to OSS. You can configure CORS rules to allow web applications or mini programs on a specific domain name to access OSS. For more information, see CORS.

Security authorization

To upload an object to OSS, you need to use the AccessKey pair of a RAM user to complete signing for authentication. However, if the client uses a permanent AccessKey pair, AccessKey pair leaks may occur, which causes data security risks. To resolve this issue, you can use one of the following solutions to implement secure upload:

Obtain temporary access credentials from STS on the application server

In most object upload scenarios, we recommend that you use Security Token Service (STS) SDKs to obtain temporary access credentials on the application server, and then use the temporary access credentials and OSS SDKs to upload objects from the client directly to OSS. The client can reuse the temporary access credentials on the application server to generate a signature. This is suitable for scenarios in which multipart upload and resumable upload are used to upload large objects. However, frequent calls to STS may cause throttling. In this case, we recommend that you cache the temporary access credentials and renew them before they expire. To further prevent abuses of temporary access credentials on the client, we recommend that you configure additional policies to restrict the use of the temporary access credentials. For more information, see What is STS?

Obtain a signature and POST policy for PostObject from the application server

In scenarios in which you want to limit the attributes of an object to upload, you need to obtain information required to call the PostObject operation from the application server. The required information includes a signature and a POST policy. Then, the client can use the obtained information to upload the object directly to OSS without using OSS SDKs. You can use the policy generated by the application server to limit the attributes of the object, such as the object size and type. This solution is suitable for scenarios in which you want to upload objects by using HTML forms. This solution does not support multipart upload and resumable upload. For more information, see PostObject.

Obtain a signed URL for PutObject from the application server

For simple object upload scenarios, you can use OSS SDKs on the application server to obtain a signed URL that is required to call the PutObject operation. Then, the client can use the signed URL to upload an object without using OSS SDKs. This solution is not suitable for multipart upload and resumable upload. The application server generates a signed URL for each part and returns the signed URL to the client. This increases the number of interactions with the application server and the complexity of network requests. In addition, the client may modify the content or order of the parts, which results in an invalid combined object. For more information, see Include a V1 signature in a URL.

Obtain temporary access credentials from STS on the application serverObtain a signature and POST policy for PostObject from the application serverObtain a signed URL for PutObject from the application server

The following figure shows how to upload an object to OSS from a client by using STS temporary access credentials returned from the application server.

The client requests temporary access credentials from the application server.

The application server uses STS SDKs to call the AssumeRole operation to obtain temporary access credentials.

STS generates and returns the temporary access credentials to the application server.

The application server returns the temporary access credentials to the client.

The client uses OSS SDKs to upload an object to OSS by using the temporary access credentials.

OSS returns a success response to the client.

Examples

The following examples provide only core code blocks. For complete code samples, download the sts.zip package.

Server-side sample code

The following sample code provides examples on how the application server obtains temporary access credentials from STS:

Note

The sample code can be deployed in Function Compute. oss-upload-sts-app

PythonJavaGoPHPNode.jsRubyC#
 
import json
from alibabacloud_tea_openapi.models import Config
from alibabacloud_sts20150401.client import Client as Sts20150401Client
from alibabacloud_sts20150401 import models as sts_20150401_models
from alibabacloud_credentials.client import Client as CredentialClient

# Replace <YOUR_ROLE_ARN> with the Alibaba Cloud Resource Name (ARN) of the RAM role that has the permissions to upload objects to the OSS bucket. 
role_arn_for_oss_upload = '<YOUR_ROLE_ARN>'
# Replace <YOUR_REGION_ID> with the ID of the region of the STS service. Example: cn-hangzhou. 
region_id = '<YOUR_REGION_ID>'

def get_sts_token():
    # If you do not specify parameters when you initialize CredentialClient, the default credential chain is used. 
    # If you run the program on your local computer, you can obtain the AccessKey pair from the ALIBABA_CLOUD_ACCESS_KEY_ID and ALIBABA_CLOUD_ACCESS_KEY_SECRET environment variables.
    # If you run the program on Elastic Compute Service (ECS) or Elastic Container Instance, you can specify the role of the bound instance by configuring the ALIBABA_CLOUD_ECS_METADATA environment variable. The SDK automatically obtains the temporary access credentials from STS. 
    config = Config(region_id=region_id, credential=CredentialClient())
    sts_client = Sts20150401Client(config=config)
    assume_role_request = sts_20150401_models.AssumeRoleRequest(
        role_arn=role_arn_for_oss_upload,
        # Replace <YOUR_ROLE_SESSION_NAME> with your custom session name, such as oss-role-session. 
        role_session_name='<YOUR_ROLE_SESSION_NAME>'
    )
    response = sts_client.assume_role(assume_role_request)
    token = json.dumps(response.body.credentials.to_map())
    return token


Client-side sample code

The following sample code provides an example on how to use the temporary access credentials to upload an object to OSS from a web client:

JavaScript
 
let credentials = null;
const form = document.querySelector("form");
form.addEventListener("submit", async (event) => {
  event.preventDefault();
  // Reobtain temporary access credentials only if they expire. This reduces the number of calls to STS. 
  if (isCredentialsExpired(credentials)) {
    const response = await fetch("/get_sts_token_for_oss_upload", {
      method: "GET",
    });
    if (!response.ok) {
      // Handle HTTP error codes. 
      throw new Error(
        'Failed to obtain STS token: ${response.status} ${response.statusText}'
      );
    }
    credentials = await response.json();
  }
  const client = new OSS({
    // Replace <YOUR_BUCKET> with the name of the OSS bucket. 
    bucket: "<YOUR_BUCKET>",
    // Replace <YOUR_REGION> with the ID of the region in which the OSS bucket is located. Example: oss-cn-hangzhou. 
    region: "oss-<YOUR_REGION>",
    accessKeyId: credentials.AccessKeyId,
    accessKeySecret: credentials.AccessKeySecret,
    stsToken: credentials.SecurityToken,
  });

  const fileInput = document.querySelector("#file");
  const file = fileInput.files[0];
  const result = await client.put(file.name, file);
  console.log(result);
});

/**
 * Determine whether the temporary access credentials expire. 
 **/
function isCredentialsExpired(credentials) {
  if (!credentials) {
    return true;
  }
  const expireDate = new Date(credentials.Expiration);
  const now = new Date();
  // If the remaining validity period of the temporary access credentials is less than 1 minute, the temporary access credentials are considered expired. 
  return expireDate.getTime() - now.getTime() <= 60000;
}
Best practices

For information about the best practices for uploading data to OSS from clients, see the following topics:

Overview of uploading objects to OSS from web clients

Set up direct data transfer for mobile applications

Feedback
Previous: Overview
Next: Upload objects to OSS from web applications

About

About Alibaba Cloud
Pricing Models
Products
Customers
Partners
Startups
Apsara Conference
Alibaba Cloud Summit

Promotions

Free Trial
Simple Application Server

Explore

China Gateway
ICP License Support
Getting Started
Blog
Marketplace
Training & Certification

Support

Contact Sales
Submit a Ticket
After-Sales Support
Security Report
Feedback
Pricing Calculator

Resources

Documentation Center
Alibaba Cloud MVP
Security & Compliance
Press Room
WHOIS
Site Map
Status

Products & Solutions

Elastic Compute Service
CDN
Anti-DDoS
Object Storage Service
eCommerce
Web Hosting
Security

Hot Content

Japan Site
ECS Documentation
How to get Domains
Software Infrastructure
Learning Path
New Users

Recommended

Topic Center
Cloud Computing
Industries
Developers
Web Developing
Tutorials
PHP Tutorials

Find Us

Payment Methods We Support

Careers About Us Privacy Policy Legal Notice List Links
© 2009-2025 Copyright by Alibaba Cloud All rights reserved
Alibaba Group Taobao Marketplace Tmall Juhuasuan AliExpress Alibaba.com 1688 Alimama Fliggy YunOS Amap UCWeb Umeng Xiami DingTalk Alipay
